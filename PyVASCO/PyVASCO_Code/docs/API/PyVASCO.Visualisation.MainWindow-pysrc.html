<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>PyVASCO.Visualisation.MainWindow</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            >PyVASCO</th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Package&nbsp;PyVASCO ::
        <a href="PyVASCO.Visualisation-module.html">Package&nbsp;Visualisation</a> ::
        Module&nbsp;MainWindow
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="PyVASCO.Visualisation.MainWindow-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="PyVASCO.Visualisation.MainWindow-module.html">Module PyVASCO.Visualisation.MainWindow</a></h1>
<pre class="py-src">
&#239;&#187;&#191;#!/usr/bin/env python
# Copyright (c) 2008-14 Qtrac Ltd. All rights reserved.
# This program or module is free software: you can redistribute it and/or
# modify it under the terms of the GNU General Public License as published
# by the Free Software Foundation, either version 2 of the License, or
# version 3 of the License, or (at your option) any later version. It is
# provided for educational purposes and is distributed in the hope that
# it will be useful, but WITHOUT ANY WARRANTY; without even the implied
# warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See
# the GNU General Public License for more details.

from __future__ import division
from __future__ import print_function
from __future__ import unicode_literals
from future_builtins import *
from datetime import datetime
from pytz import timezone

import os
import platform
import sys
import numpy as np

import PropertyWindow
#import ExternalDataWindow
import Scrubbing
import PressureRiseDifferentSEY
import NewMaterialWindow,NewPumpWindow,NewGasSourceWindow,NewESDcurve,NewInput


from PyQt4.QtCore import (PYQT_VERSION_STR, QFile, QFileInfo, QSettings,
        QString, QT_VERSION_STR, QTimer, QVariant, Qt,QDir, QReadLocker, QReadWriteLock, QRectF)
from PyQt4.QtCore import pyqtSignal as Signal
from PyQt4.QtGui import *
import pyqtgraph as pg #built on PYQT4 / PySide and numpy
import pyqtgraph.opengl as gl
from Components.ESD import ESD
import webbrowser

#import Config
from Computation import dataDensity
from Config import Config
from Computation.dataDensity import Density 
#from dataDensity import Density
from Computation.Core2 import Calculate, GetSegments
#from InputTransform import Main_Material_Transformation
from InputFormat.InputTransform import Main_Material_Transformation
import Analysis
#import helpform
#import newimagedlg
#import qrc_resources


__version__ = "1.0.0"



  
class Window(QMainWindow):
    """
    Main window of PyVASCO. Inheritates from QMainWindow
    """
    oldFormatFilePath=''
    filePath=''

    def __init__(self, parent=None):
        super(Window, self).__init__(parent)
        self.tabWidget=QTabWidget()
        #self.image = QImage()
        self.dirty = False
        self.filename = Config.DataFile #QDir.homePath() #None
        #self.mirroredvertically = False
        #self.mirroredhorizontally = False
        #self.printer = None
        self.create_widgets()
        self.create_actions()
        self.create_menu()
        self.initiateMainWindow()
        self.create_connections()
        #self.create_actions()
        #self.load_settings()
        self.setWindowTitle("PyVASCO")
        #self.updateFileMenu()
        #QTimer.singleShot(0, self.loadInitialFile)
        self.nameEdit.selectAll()
        self.nameEdit.setFocus()
        self.setCentralWidget(self.tabWidget)
        self.center()

    def create_menu(self):
        """
        Creates main menu.
        """
        self.menuBar= QMenu("TextEffect")


    def create_tab1(self):
        """
        Place and initialize all the widgets in Tab 1, labeled 'Data', of PyVASCO.
        """
        tab1Widget=QWidget()

        Frame1=QGroupBox("Load Data")
        Frame2=QGroupBox("Set beam parameters")
        Frame3=QGroupBox("Plot properties")
        Frame4=QGroupBox("Current Dynamics and critical current")
        #Frame4=QFrame()
        Frame6=QGroupBox("Estimation of the ESD from electron dose")
        Frame5=QGroupBox("Start Simulation")

        #widgets for FRAME 1 
        nameLabel = QLabel("Name of Simulation")
        self.nameEdit = QLineEdit("")
        self.transformButton = QPushButton("Transform...")
        self.transformDirectoryButton = QPushButton("Open Directory: Input file_Old ")
        self.transformEdit = QLineEdit()
        self.uploadButton = QPushButton("Open Directory: Input file_New")
        self.uploadEdit = QLineEdit()
        self.saveButton = QPushButton("Save results in folder")
        self.saveEdit = QLineEdit()
        self.gaugesButton = QPushButton("Gauges value")
        self.gaugesEdit = QLineEdit()
        self.gaugesSpinbox = QDoubleSpinBox(value=0, singleStep=0.1, minimum = -100000., maximum = 100000. )
        self.savetxtCheckBox = QCheckBox("Save simulation values in csv-file")
        self.savepngCheckBox = QCheckBox("Save simulation as png-file/Compare Data")
        self.ThreeDCheckBox = QCheckBox("Print 3D sketch of the domain")
        self.savepngCheckBox.setDisabled(True)
        #self.ThreeDCheckBox.setDisabled(True)
        #widgets for FRAME 2 
        currentLabel = QLabel("Beam Current [A]")
        self.currentEdit = QLineEdit("0.5")

        #instabilitiesLabel = QLabel("Degree of Recovering Instabilities")
        #self.instabilitiesSlider = QSlider(Qt.Horizontal)
        plottingLabel = QLabel("Plotting Quality")
        self.plottingSlider = QSlider(Qt.Horizontal, value=10)
        self.logCheckBox = QCheckBox("Logarithmic Scale")

        #widgets for FRAME 3
        shiftLabel = QLabel("Shift x-axis [m]")
        self.shiftEdit = QLineEdit()

        specieLabel = QLabel("Choose gas species:")

        self.allgasCheckBox = QCheckBox("Select all gas species")
        self.h2CheckBox = QCheckBox("H2")
        self.ch4CheckBox = QCheckBox("CH4")
        self.coCheckBox = QCheckBox("CO")
        self.co2CheckBox = QCheckBox("CO2")
        self.totalCheckBox = QCheckBox("Total of all gas species")

        massLabel = QLabel("Molecular weight: ") #nist.gov
        self.massEdit1 = QLineEdit("2.01588")
        self.massEdit2 = QLineEdit("16.0425")
        self.massEdit3 = QLineEdit("28.0101")
        self.massEdit4 = QLineEdit("44.0095")

        crossSectionLabel = QLabel("Ionization cross section: ")
        self.crossSectionEdit1 = QLineEdit("4.45E-23")
        self.crossSectionEdit2 = QLineEdit("3.18E-22")
        self.crossSectionEdit3 = QLineEdit("2.75E-22")
        self.crossSectionEdit4 = QLineEdit("4.29E-22")
        sensitivityLabel = QLabel("Sensitivityfactor:")

        self.densityRadioButton = QRadioButton("Density")
        self.pressureRadioButton = QRadioButton("Pressure")
        self.h2SpinBox = QDoubleSpinBox(value=1.0, singleStep=0.05, minimum=0.1)
        self.ch4SpinBox = QDoubleSpinBox(value=1.0, singleStep=0.05, minimum=0.1)
        self.coSpinBox = QDoubleSpinBox(value=1.0, singleStep=0.05, minimum=0.1)
        self.co2SpinBox = QDoubleSpinBox(value=1.0, singleStep=0.05, minimum=0.1)
        self.totalSpinBox = QDoubleSpinBox(value=1.0 ,singleStep=0.1, minimum=0.1)



        #widgets for FRAME 4
        self.currentCheckBox = QCheckBox("Current Calculations")
        #self.currentCheckBox.setDisabled(True)
        initialcurrentLabel = QLabel("Initial current [A]")
        self.initialcurrentSpinBox = QDoubleSpinBox(value=1.0, singleStep=0.1, minimum=0.1)

        precisioncurrentLabel = QLabel("Precission [A]")
        self.precisioncurrentSpinBox = QDoubleSpinBox(value=0.1, singleStep=0.1, minimum=0.1)

        ''' Unbar to go back to IdaVac's original version
        endcurrentLabel = QLabel("End current [A]")
        self.endcurrentSpinBox = QDoubleSpinBox(value=50.0, singleStep=0.1, minimum=0.1, maximum=500)
        '''
        stepscurrentLabel = QLabel("calculation steps")
        self.stepscurrentSpinBox = QSpinBox(value=10)

        #widgets for FRAME 5
        self.runsimulationButton = QPushButton("Run Simulation")


        #widgets for FRAME 6
        self.esdFromDoseCheckBox = QCheckBox("Compute ESD from estimated electron dose")
        self.esdFromDoseLabel = QLabel("Estimated electron dose [e-/cm^2]")
        self.esdFromDoseSlider = QSlider(Qt.Horizontal,value=6)
        self.esdFromDoseSlider.setMinimum(13)
        self.esdFromDoseSlider.setMaximum(19)
        self.esdFromDoseSlider.setValue(15)
        self.esdFromDoseInfo = QLabel("1e" + str(self.esdFromDoseSlider.value()))
        self.TotalOutgassingMaterialsLabel = QLabel("Use total Outgassing [mbar l/s] for materials: ")
        self.TotalOutgassingMaterials = QLineEdit("BCu,BCu2")



        # +++++++++++ LAYOUT
        tab1Layout=QVBoxLayout() # how the frames are aligned

        frame1Layout=QGridLayout() # how the items within one frame are aligned
        frame1Layout.addWidget(nameLabel,0,0)
        frame1Layout.addWidget(self.nameEdit,0,1)
        frame1Layout.addWidget(self.transformDirectoryButton,1,0)
        frame1Layout.addWidget(self.transformEdit,1,1)
        frame1Layout.addWidget(self.transformButton,1,2)

        frame1Layout.addWidget(self.uploadButton,2,0)
        frame1Layout.addWidget(self.uploadEdit,2,1)
        frame1Layout.addWidget(self.saveButton,3,0)
        frame1Layout.addWidget(self.saveEdit,3,1)
        frame1Layout.addWidget(self.gaugesButton,4,0)
        frame1Layout.addWidget(self.gaugesEdit,4,1)
        frame1Layout.addWidget(self.gaugesSpinbox,4,2)

        frame1Layout.addWidget(self.savetxtCheckBox,5,0)
        frame1Layout.addWidget(self.savepngCheckBox,6,0)
        frame1Layout.addWidget(self.ThreeDCheckBox,7,0)

        Frame1.setLayout(frame1Layout)


        frame2Layout=QGridLayout()
        frame2Layout.addWidget(currentLabel,0,0)
        frame2Layout.addWidget(self.currentEdit,0,1)





        #frame2Layout.addWidget(instabilitiesLabel,1,0)
        #frame2Layout.addWidget(self.instabilitiesSlider,1,1)
        frame2Layout.addWidget(plottingLabel,1,0)
        frame2Layout.addWidget(self.plottingSlider,1,1)
        frame2Layout.addWidget(self.logCheckBox,2,0)
        Frame2.setLayout(frame2Layout)




        frame3Layout=QGridLayout()
        frame3Layout.addWidget(shiftLabel,0,0)
        frame3Layout.addWidget(self.shiftEdit,0,1)
        frame3Layout.addWidget(self.densityRadioButton,1,0)
        frame3Layout.addWidget(self.pressureRadioButton,1,1)
        frame3Layout.addWidget(specieLabel,2,0)
        frame3Layout.addWidget(self.allgasCheckBox,3,0)
        frame3Layout.addWidget(massLabel,3,1)
        frame3Layout.addWidget(crossSectionLabel,3,2)

        frame3Layout.addWidget(sensitivityLabel,3,3)

        frame3Layout.addWidget(self.massEdit1,4,1)
        frame3Layout.addWidget(self.massEdit2,5,1)
        frame3Layout.addWidget(self.massEdit3,6,1)
        frame3Layout.addWidget(self.massEdit4,7,1)


        frame3Layout.addWidget(self.crossSectionEdit1,4,2)
        frame3Layout.addWidget(self.crossSectionEdit2,5,2)
        frame3Layout.addWidget(self.crossSectionEdit3,6,2)
        frame3Layout.addWidget(self.crossSectionEdit4,7,2)

        frame3Layout.addWidget(self.h2CheckBox,4,0)
        frame3Layout.addWidget(self.h2SpinBox,4,3)
        frame3Layout.addWidget(self.ch4CheckBox,5,0)
        frame3Layout.addWidget(self.ch4SpinBox,5,3)
        frame3Layout.addWidget(self.coCheckBox,6,0)
        frame3Layout.addWidget(self.coSpinBox,6,3)
        frame3Layout.addWidget(self.co2CheckBox,7,0)
        frame3Layout.addWidget(self.co2SpinBox,7,3)
        frame3Layout.addWidget(self.totalCheckBox,8,0)
        frame3Layout.addWidget(self.totalSpinBox,8,3)
        Frame3.setLayout(frame3Layout)



        frame4Layout=QGridLayout()
        frame4Layout.addWidget(self.currentCheckBox,0,0)

        frame4Layout.addWidget(initialcurrentLabel,1,0)
        frame4Layout.addWidget(self.initialcurrentSpinBox,1,1)

        frame4Layout.addWidget(precisioncurrentLabel, 1, 2)
        frame4Layout.addWidget(self.precisioncurrentSpinBox, 1, 3)

        '''
        # Unbar to go back to IdaVac original version
        frame4Layout.addWidget(endcurrentLabel,1,2)
        frame4Layout.addWidget(self.endcurrentSpinBox,1,3)
        '''
        frame4Layout.addWidget(stepscurrentLabel,1,4)
        frame4Layout.addWidget(self.stepscurrentSpinBox,1,5)

        Frame4.setLayout(frame4Layout)

        frame5Layout=QGridLayout()
        frame5Layout.addWidget(self.runsimulationButton,0,0)
        Frame5.setLayout(frame5Layout)


        frame6Layout = QGridLayout()
        frame6Layout.addWidget(self.esdFromDoseCheckBox,0,0)
        frame6Layout.addWidget(self.esdFromDoseLabel,1,0)
        frame6Layout.addWidget(self.esdFromDoseSlider,1,1)
        frame6Layout.addWidget(self.esdFromDoseInfo,1,2)
        frame6Layout.addWidget(self.TotalOutgassingMaterialsLabel, 2,0)
        frame6Layout.addWidget(self.TotalOutgassingMaterials,2,2)
        Frame6.setLayout(frame6Layout)


        #layout.addStretch()

        tab1Layout.addWidget(Frame1)
        tab1Layout.addWidget(Frame2)
        tab1Layout.addWidget(Frame3)
        tab1Layout.addWidget(Frame4)
        tab1Layout.addWidget(Frame6)
        tab1Layout.addWidget(Frame5)




        tab1Widget.setLayout(tab1Layout)
        self.tabWidget.addTab(tab1Widget, "Data")




    def create_tab2(self):
        """
        Place and initialize all the widgets in Tab 2, labeled 'Simulation',  of PyVASCO.
        :return: None
        """
        tab2Widget=QWidget()

        #item
        view = QWidget()
        self.l = QVBoxLayout()
        view.setLayout(self.l)
        labelStyle = {'color': '#FFF', 'font-size': '14pt'}
        self.densityPlotWidget=pg.PlotWidget(title='Density-Plot', )
        self.densityPlotWidget.setLabel('left', "Density", units='particles per m3', **labelStyle)
        self.densityPlotWidget.setLabel('bottom', "Axis along beam line", units='m', **labelStyle)
        self.densityPlotWidget.addLegend()
        self.densityPlotWidget.showGrid(True, True, 0.5)

        self.geometryPlotWidget=pg.PlotWidget(title='Geometry',**labelStyle)
        self.geometryPlotWidget.setLabel('left', "Diameter", units='m', **labelStyle)
        self.geometryPlotWidget.setLabel('bottom', "Axis along beam line", units='m', **labelStyle)
        self.geometryPlotWidget.addLegend()

        self.l.addWidget(self.densityPlotWidget)
        self.l.addWidget(self.geometryPlotWidget)
        self.geometryPlotWidget.setXLink(self.densityPlotWidget)
        self.geometryPlotWidget.showGrid(True, True, 0.5)

        width_gas = 1.5
        width_total = 2

        self.plotH2 = self.densityPlotWidget.plot(pen = pg.mkPen(color=Config.ColorPalette['ColorH2'], width=width_gas), name = 'H2')
        self.plotCH4 = self.densityPlotWidget.plot(pen = pg.mkPen(color=Config.ColorPalette['ColorCH4'], width=width_gas), name = 'CH4')
        self.plotCO = self.densityPlotWidget.plot(pen = pg.mkPen(color=Config.ColorPalette['ColorCO'], width=width_gas), name = 'CO')
        self.plotCO2 = self.densityPlotWidget.plot(pen = pg.mkPen(color=Config.ColorPalette['ColorCO2'], width=width_gas), name = 'CO2')
        self.plot_total = self.densityPlotWidget.plot(pen = pg.mkPen(color=Config.ColorPalette['Colortotal'], width=width_total), name = 'total density')
        self.plot_Data = self.densityPlotWidget.plot(pen= None, symbol = 'o', symbolSize = 5, symbolPen = (255, 255, 255, 200), symbolBrush = (0,0,255,150), name = 'LHC data')
        self.plot_Data_blue = self.densityPlotWidget.plot(pen= None, symbol = '+', symbolSize = 5, symbolPen = (255, 255, 255, 200), symbolBrush = (0,0,255,150), name = 'LHC data')






        #self.plot_Data_min = self.densityPlotWidget.plot(x= xvals , y= yvals_min , pen= None, symbol = 'o', symbolSize = 5, symbolPen = (255, 204, 153, 200), symbolBrush = (0,0,255,150))
        #self.plot_Data_max = self.densityPlotWidget.plot(x= xvals , y= yvals_max , pen= None, symbol = 'o', symbolSize = 5, symbolPen = (255, 64, 64, 200), symbolBrush = (0,0,255,150))

        tab2Layout=QVBoxLayout()

        tab2Layout.addWidget(self.densityRadioButton)
        tab2Layout.addWidget(self.pressureRadioButton)
        tab2Layout.addWidget(view)
        tab2Widget.setLayout(tab2Layout)
        self.tabWidget.addTab(tab2Widget, "Simulation")

    def create_tab3(self):
        """
        Place and initialize all the widgets in Tab 3, labeled 'Critical Current', of PyVASCO.
        :return: None
       """
        self.critCurrentLabel = QLabel("")
        tab3Widget=QWidget()

        view = QWidget()
        l = QVBoxLayout()
        view.setLayout(l)

        critCurrent1PlotWidget=pg.PlotWidget(title='Density profile at different currents')
        critCurrent1PlotWidget.setLogMode(False, True)
        critCurrent2PlotWidget=pg.PlotWidget(title='Dynamic Current')
        l.addWidget(critCurrent1PlotWidget)
        l.addWidget(critCurrent2PlotWidget)

        labelStyle = {'color': '#FFF', 'font-size': '14pt'}
        critCurrent1PlotWidget.setLabel('left', "Density", units='particles per m3', **labelStyle)
        critCurrent1PlotWidget.setLabel('bottom', "Axis along beam line", units='m', **labelStyle)
        critCurrent2PlotWidget.setLabel('left', "Density", units='particles per m3', **labelStyle)
        critCurrent2PlotWidget.setLabel('bottom', "Current", units='A', **labelStyle)
        critCurrent2PlotWidget.addLegend()
        self.critLegend =critCurrent1PlotWidget.addLegend()

        self.plotCurrent1 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorH2'])
        self.plotCurrent2 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorCH4'])
        self.plotCurrent3 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorCO'])
        self.plotCurrent4 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorCO2'])
        #self.plotCurrent5 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['Colortotal'])
        '''
        self.plotCurrent1 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorH2'], name = 'H2')
        self.plotCurrent2 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorCH4'], name = 'CH4')
        self.plotCurrent3 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorCO'], name = 'CO')
        self.plotCurrent4 = critCurrent1PlotWidget.plot(pen=Config.ColorPalette['ColorCO2'], name = 'CO2')
        '''

        self.CurrentDyn1Plot = critCurrent2PlotWidget.plot(pen=Config.ColorPalette['ColorH2'], name = 'H2')
        self.CurrentDyn2Plot = critCurrent2PlotWidget.plot(pen=Config.ColorPalette['ColorCH4'], name = 'CH4')
        self.CurrentDyn3Plot = critCurrent2PlotWidget.plot(pen=Config.ColorPalette['ColorCO'], name = 'CO')
        self.CurrentDyn4Plot = critCurrent2PlotWidget.plot(pen=Config.ColorPalette['ColorCO2'], name = 'CO2')


        tab3Layout=QVBoxLayout()
        tab3Layout.addWidget(self.critCurrentLabel)
        tab3Layout.addWidget(view)
        tab3Widget.setLayout(tab3Layout)
        self.tabWidget.addTab(tab3Widget, "Critical Current")


    def create_tab4(self):
        """
        Place and initialize all the widgets in Tab 4, labeled 'Analysis Configuration',  of PyVASCO.
       : return: None
       """
        tab4Widget=QWidget()

        Frame1=QGroupBox("Upload Results in csv.format")
        Frame2=QGroupBox("Sensitivity Analysis")
        Frame3=QGroupBox("Start Simulation")

        #widgets for FRAME 1 
        infoLabel = QLabel("Upload data from csv. file: ")
        self.upload1DirectoryLabel = QLabel()
        self.upload1DirectoryButton = QPushButton("Directory to: Upload1")
        self.formatLabel = QLabel("format: ")
        self.formatComboBox = QComboBox()
        self.formatComboBox.setFont(QFont('Verdana'))
        self.formatComboBox.addItems(['x  | y\u2081 | y\u2082 | y\u2083 | y\u2084',' x\u2081 | y\u2081 | x\u2082 | y\u2082 | x\u2083 | y\u2083 | x\u2084 | y\u2084'])
        self.unitLabel = QLabel("unit: ")
        self.unitComboBox = QComboBox()
        self.unitComboBox.addItems(["density -> density", "density -> mbar", "mbar -> mbar", "mbar -> density", "torr -> mbar"])


        self.Plot1_All_CheckBox = QCheckBox("Total of selected.")
        self.Plot1CheckBox = QCheckBox("y\u2081")
        self.Plot1CheckBox.setFont(QFont('Verdana'))
        self.Plot1CheckBox.click()
        self.Plot2CheckBox = QCheckBox(" y\u2082")
        self.Plot2CheckBox.setFont(QFont('Verdana'))
        self.Plot2CheckBox.click()
        self.Plot3CheckBox = QCheckBox(" y\u2083")
        self.Plot3CheckBox.setFont(QFont('Verdana'))
        self.Plot3CheckBox.click()
        self.Plot4CheckBox = QCheckBox(" y\u2084")
        self.Plot4CheckBox.setFont(QFont('Verdana'))
        self.Plot4CheckBox.click()

        self.upload2DirectoryLabel = QLabel()
        self.upload2DirectoryButton = QPushButton("Directory to: Upload2")
        self.format2Label = QLabel("format: ")
        self.format2ComboBox = QComboBox()
        self.format2ComboBox.setFont(QFont('Verdana'))
        self.format2ComboBox.addItems(['x | y\u2081 | y\u2082 | y\u2083 | y\u2084',' x\u2081 | y\u2081 | x\u2082 | y\u2082 | x\u2083 | y\u2083 | x\u2084 | y\u2084'])
        self.unit2Label = QLabel("unit: ")
        self.unit2ComboBox = QComboBox()
        self.unit2ComboBox.addItems(["density -> density", "density -> mbar", "mbar -> mbar", "mbar -> density", "torr -> mbar"])

        self.Plot5_All_CheckBox = QCheckBox("Total of selected.")
        self.Plot5CheckBox = QCheckBox("y\u2081")
        self.Plot5CheckBox.setFont(QFont('Verdana'))
        self.Plot5CheckBox.click()
        self.Plot6CheckBox = QCheckBox(" y\u2082")
        self.Plot6CheckBox.setFont(QFont('Verdana'))
        self.Plot6CheckBox.click()
        self.Plot7CheckBox = QCheckBox(" y\u2083")
        self.Plot7CheckBox.setFont(QFont('Verdana'))
        self.Plot7CheckBox.click()
        self.Plot8CheckBox = QCheckBox(" y\u2084")
        self.Plot8CheckBox.setFont(QFont('Verdana'))
        self.Plot8CheckBox.click()


        #widgets for FRAME 2 
        self.logAnalysisCheckBox = QCheckBox("logarithmic scale")
        self.logAnalysisCheckBox.setChecked(True)

        #widgets for FRAME 3
        self.runAnalysisButton = QPushButton("Run Analysis")


        # +++++++++++ LAYOUT
        tab4Layout=QVBoxLayout() # how the frames are aligned

        frame1Layout=QGridLayout() # how the items within one frame are aligned
        frame1Layout.addWidget(infoLabel,0,0)
        frame1Layout.addWidget(self.upload1DirectoryButton,1,0)
        frame1Layout.addWidget(self.upload1DirectoryLabel,1,1)
        frame1Layout.addWidget(self.formatLabel,2,1)
        frame1Layout.addWidget(self.formatComboBox,2,2)
        frame1Layout.addWidget(self.unitLabel,3,1)
        frame1Layout.addWidget(self.unitComboBox,3,2)
        frame1Layout.addWidget(self.Plot1_All_CheckBox,1,3)
        frame1Layout.addWidget(self.Plot1CheckBox,2,3)
        frame1Layout.addWidget(self.Plot2CheckBox,2,4)
        frame1Layout.addWidget(self.Plot3CheckBox,2,5)
        frame1Layout.addWidget(self.Plot4CheckBox,2,6)



        frame1Layout.addWidget(self.upload2DirectoryButton,4,0)
        frame1Layout.addWidget(self.upload2DirectoryLabel,4,1)
        frame1Layout.addWidget(self.format2Label,5,1)
        frame1Layout.addWidget(self.format2ComboBox,5,2)
        frame1Layout.addWidget(self.unit2Label,6,1)
        frame1Layout.addWidget(self.unit2ComboBox,6,2)
        frame1Layout.addWidget(self.Plot5_All_CheckBox,4,3)
        frame1Layout.addWidget(self.Plot5CheckBox,5,3)
        frame1Layout.addWidget(self.Plot6CheckBox,5,4)
        frame1Layout.addWidget(self.Plot7CheckBox,5,5)
        frame1Layout.addWidget(self.Plot8CheckBox,5,6)


        Frame1.setLayout(frame1Layout)

        #FRAME 2
        frame2Layout=QGridLayout() # how the items within one frame are aligned
        frame2Layout.addWidget(self.logAnalysisCheckBox,0,0)
        Frame2.setLayout(frame2Layout)


        frame3Layout=QGridLayout()
        frame3Layout.addWidget(self.runAnalysisButton,0,0)
        Frame3.setLayout(frame3Layout)

        #layout.addStretch()

        tab4Layout.addWidget(Frame1)
        tab4Layout.addWidget(Frame2)
        tab4Layout.addWidget(Frame3)



        tab4Widget.setLayout(tab4Layout)
        self.tabWidget.addTab(tab4Widget, "Analysis Configuration")


    def create_tab5(self):
        """
        Place and initialize all the widgets in Tab 4, labeled 'Analysis and Comparison',  of PyVASCO.
        :return: None
        """
        tab5Widget=QWidget()

        view = QWidget()
        l = QVBoxLayout()
        view.setLayout(l)
        labelStyle = {'color': '#FFF', 'font-size': '14pt' , 'height': '10pt'}
        b = QFont("Verdana", 22)
        self.AnalysisPlotWidget=pg.PlotWidget(name='Comparison: MolFlow and PyVASCO')
        self.AnalysisPlotWidget.getAxis('bottom').tickFont=b
        self.AnalysisPlotWidget.getAxis('left').tickFont=b
        self.AnalysisPlotWidget.setLabel('left', "Pressure (mbar)", **labelStyle)
        self.AnalysisPlotWidget.setLabel('bottom', "Axis alongbeam line (m)", **labelStyle)
        self.AnalysisPlotWidget.showGrid(True, True, 0.5)
        #self.AnalysisPlotWidget.setLogMode(False, True)
        self.logAnalysis()

        self.AnalysisPlotWidget.addLegend()
        #critCurrent2PlotWidget=pg.PlotWidget(name='Critical Current 2')
        l.addWidget(self.AnalysisPlotWidget)
        #l.addWidget(critCurrent2PlotWidget)

        #uploadDir = Config.Upload1






        '''
        x_Val_ida  = [x  for x in x_Val_ida ]
        y_val1_ida  = [1.5*x*300*1.3806488e-23*0.01  for x in y_val1_ida ]
        y_val2_ida  = [1.5*x*300*1.3806488e-23*0.01  for x in y_val2_ida ]
        y_val3_ida  = [1.5*x*300*1.3806488e-23*0.01  for x in y_val3_ida ]
        y_val4_ida  = [1.5*x*300*1.3806488e-23*0.01  for x in y_val4_ida ]

        '''
        width_Analysis = 3
        #self.Plot1 = self.AnalysisPlotWidget.plot(fillLevel=0, brush = (50,50,200,100), name = 'Total Density (without beam)')
        #self.Plot2 = self.AnalysisPlotWidget.plot(fillLevel=0, brush =Config.ColorPalette['ColorCH4'], name = 'Total Density (only SR)')
        #self.Plot3 = self.AnalysisPlotWidget.plot(fillLevel=0, brush =Config.ColorPalette['ColorCO'], name = 'Total Density (with SR and EC)')
        #self.Plot4 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCO2'],  width=width_Analysis), name = 'Total Density (without beam)')
        self.Plot1 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorH2'],  width=width_Analysis), name = 'Upload1: Plot1')
        self.Plot2 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCH4'],  width=width_Analysis), name = 'Upload1: Plot2')
        self.Plot3 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCO'],  width=width_Analysis), name = 'Upload1: Plot3')
        self.Plot4 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCO2'],  width=width_Analysis), name = 'Upload1: Plot4')



        self.Plot5 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorH2'],  width=width_Analysis, style=Qt.DotLine), name = 'Upload2: Plot1')
        self.Plot6 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCH4'],  width=width_Analysis, style=Qt.DotLine), name = 'Upload2: Plot2')
        self.Plot7 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCO'],  width=width_Analysis, style=Qt.DotLine), name = 'Upload2: Plot3')
        self.Plot8 = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['ColorCO2'],  width=width_Analysis, style=Qt.DotLine), name = 'Upload2: Plot4')
        self.Plot1_total = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['LightGray'],  width=width_Analysis), name = 'Total1')
        self.Plot5_total = self.AnalysisPlotWidget.plot(pen= pg.mkPen(color=Config.ColorPalette['Gray'],  width=width_Analysis), name = 'Total2')






        tab5Layout=QVBoxLayout()
        tab5Layout.addWidget(view)
        tab5Widget.setLayout(tab5Layout)
        self.tabWidget.addTab(tab5Widget, "Analysis and Comparison")


    def create_tab6(self):
        """
        Place and initialize all the widgets in Tab 6, labeled 'Scrubbing Simulation',  of PyVASCO.
        :return: None
        """
        # Study of the Scrubbing effect
        tab6Widget = QWidget()
        #view = QWidget()
        #l = QVBoxLayout()
        #view.setLayout(l)

        # FRAMES :
        Frame1 = QGroupBox("Scrubbing simulation")
        Frame2 = QGroupBox("Results")

        #  Widgets for Frame1: Simulation menu
        self.uploadScrubbingButton = QPushButton("Open Directory: Input file_New")
        self.uploadEdit = QLineEdit()
        self.scrubbingSpinBox =QDoubleSpinBox(value=5, singleStep=1, minimum=2)
        self.scrubbingLabel = QLabel("Number of different Electron Doses to simulate :")
        self.scrubbingPushButton = QPushButton("Start simultation")
        self.useSEYScrubbingCheckButton = QCheckBox("Consider decrease of SEY with electron dose")

        # Widgets for Frame2: Plot
        self.scrubbingPlotWidget = pg.PlotWidget(title='Pressure profile ')
        self.scrubbingPlotWidget.setLogMode(False, True)
        labelStyle = {'color': '#FFF', 'font-size': '14pt'}
        self.scrubbingPlotWidget= pg.PlotWidget(title='Scrubbing-Plot', )
        self.scrubbingPlotWidget.setLabel('left', "Density", units='particles per m3', **labelStyle)
        self.scrubbingPlotWidget.setLabel('bottom', "Axis along beam line", units='m', **labelStyle)
        self.scrubbingLegend = self.scrubbingPlotWidget.addLegend()
        self.scrubbingPlotWidget.showGrid(True, True, 0.5)

        self.plotScrubbing1 = self.scrubbingPlotWidget.plot(pen=Config.ColorPalette['ColorH2'])
        self.plotScrubbing2 = self.scrubbingPlotWidget.plot(pen=Config.ColorPalette['ColorCH4'])
        self.plotScrubbing3 = self.scrubbingPlotWidget.plot(pen=Config.ColorPalette['ColorCO'])
        self.plotScrubbing4 = self.scrubbingPlotWidget.plot(pen=Config.ColorPalette['ColorCO2'])
        self.plotScrubbing5 = self.scrubbingPlotWidget.plot(pen=Config.ColorPalette['Colortotal'])

        # +++++++++++ LAYOUT
        tab6Layout = QVBoxLayout()  # how the frames are aligned

        # Frame 1
        frame1Layout = QGridLayout()  # how the items within one frame are aligned
        frame1Layout.addWidget(self.uploadScrubbingButton,0,0)
        frame1Layout.addWidget(self.uploadEdit,0,1)
        #frame1Layout.addWidget(self.scrubbingLabel,0,0)
        #frame1Layout.addWidget(self.scrubbingSpinBox,0,1)
        frame1Layout.addWidget(self.scrubbingPushButton, 1, 0)

        Frame1.setLayout(frame1Layout)

        # Frame 2
        frame2Layout = QGridLayout()
        frame2Layout.addWidget(self.scrubbingPlotWidget,0,0)
        Frame2.setLayout(frame2Layout)

        tab6Layout.addWidget(Frame1)
        tab6Layout.addWidget(Frame2)


        tab6Widget.setLayout(tab6Layout)
        self.tabWidget.addTab(tab6Widget, "Scrubbing Simulation")

    def create_tab7(self):
        """
        Place and initialize all the widgets in Tab 4, labeled 'TDIS',  of PyVASCO.
        :return: None
        """
        #TDIS
        tab7Widget = QWidget()
        # view = QWidget()
        # l = QVBoxLayout()
        # view.setLayout(l)

        # FRAMES :
        Frame1 = QGroupBox("TDIS simulation parameters")
        Frame2 = QGroupBox("Results")

        #  Widgets for Frame1: Simulation menu
        self.TDISSimulationMode = QLabel("Select Simulation Mode:")
        self.TDISScrubbingRadioButton = QRadioButton("Scrubbing. Assumed Homogeneous SEY")
        self.TDISCaseStudyRadioButton = QRadioButton("Non-Homogeneous SEY distribution")

        self.TDISBeamCurrentLabel = QLabel("Beam Current [A] :")
        self.TDISBeamCurrentEdit = QLineEdit("0.5")

        self.TDISUseTotalQCheckBox = QCheckBox("Use total outgassing for TDIS tanks")
        self.TDISPushButton = QPushButton("Run Simulation")

        # Widgets for Frame2: Plot
        self.TDISPlotWidget = pg.PlotWidget(title='Maximum Pressure Raise ')
        self.TDISPlotWidget.setLogMode(False, True)
        labelStyle = {'color': '#FFF', 'font-size': '14pt'}
        self.TDISPlotWidget = pg.PlotWidget(title='TDI-Plot', )
        self.TDISPlotWidget.setLabel('left', "Maximum pressure raise", units='mbar', **labelStyle)
        self.TDISPlotWidget.setLabel('bottom', "Half-Gap", units='mm', **labelStyle)
        self.TDISLegend = self.TDISPlotWidget.addLegend()
        self.TDISPlotWidget.showGrid(True, True, 0.5)

        self.plotTDIS1 = self.TDISPlotWidget.plot(pen=Config.ColorPalette['ColorH2'])
        self.plotTDIS2 = self.TDISPlotWidget.plot(pen=Config.ColorPalette['ColorCH4'])
        self.plotTDIS3 = self.TDISPlotWidget.plot(pen=Config.ColorPalette['ColorCO'])
        self.plotTDIS4 = self.TDISPlotWidget.plot(pen=Config.ColorPalette['ColorCO2'])
        self.plotTDIS5 = self.TDISPlotWidget.plot(pen=Config.ColorPalette['Colortotal'])
        self.plotTDIS6 = self.TDISPlotWidget.plot(pen=Config.ColorPalette['BlueA'])

        # +++++++++++ LAYOUT
        tab7Layout = QVBoxLayout()

        # Frame 1
        frame1Layout = QGridLayout()  # how the items within one frame are aligned
        frame1Layout.addWidget(self.TDISSimulationMode,0,0)
        frame1Layout.addWidget(self.TDISScrubbingRadioButton, 1, 0)
        frame1Layout.addWidget(self.TDISCaseStudyRadioButton, 1, 1)

        frame1Layout.addWidget(self.TDISBeamCurrentLabel, 2, 0)
        frame1Layout.addWidget(self.TDISBeamCurrentEdit, 2, 1)
        #frame1Layout.addWidget(self.TDISUseTotalQCheckBox,3,1)
        frame1Layout.addWidget(self.TDISPushButton, 3, 2)

        Frame1.setLayout(frame1Layout)

        # Frame 2
        frame2Layout = QGridLayout()
        frame2Layout.addWidget(self.TDISPlotWidget,0,0)

        Frame2.setLayout(frame2Layout)

        tab7Layout.addWidget(Frame1)
        tab7Layout.addWidget(Frame2)

        tab7Widget.setLayout(tab7Layout)

        self.tabWidget.addTab(tab7Widget, "TDIS")


    def create_widgets(self):
        """
        Initialize the different tabs of PyVASCO.
        :return:None
        """
        self.create_tab1()
        self.create_tab2()
        self.create_tab3()
        self.create_tab4()
        self.create_tab5()
        self.create_tab6()
        self.create_tab7()

    def create_connections(self):
        """
        Creates the connections between the GUI widgets and the callback functions.

        """
        print('create_connections')
        self.transformDirectoryButton.clicked.connect(self.oldfileDirectory)
        self.transformButton.clicked.connect(self.transformInput)
        self.uploadButton.clicked.connect(self.fileNew)
        self.saveButton.clicked.connect(self.saveDirectory)
        self.gaugesButton.clicked.connect(self.gaugesUpload)
        self.runsimulationButton.clicked.connect(self.runSimulation)
        self.allgasCheckBox.stateChanged.connect(self.checkallgas)
        self.pressureRadioButton.toggled.connect(self.PressureDensity)
        self.logCheckBox.stateChanged.connect(self.logScale)
        self.plottingSlider.valueChanged.connect(self.PlottingQuality)



        self.esdFromDoseSlider.valueChanged.connect(self.setESDFromDose)
        #self.seyFromDoseCheckBox.connect()



        #Visibility of Plot according to checkbox value
        self.h2CheckBox.stateChanged.connect(self.h2Visible)
        self.ch4CheckBox.stateChanged.connect(self.ch4Visible)
        self.coCheckBox.stateChanged.connect(self.coVisible)
        self.co2CheckBox.stateChanged.connect(self.co2Visible)
        self.totalCheckBox.stateChanged.connect(self.totalVisible)

        self.gaugesEdit.textChanged.connect(self.updateLHCData)

        #Sensitivityfactor:
        self.h2SpinBox.valueChanged.connect(self.h2Sensitivity)
        self.ch4SpinBox.valueChanged.connect(self.ch4Sensitivity)
        self.coSpinBox.valueChanged.connect(self.coSensitivity)
        self.co2SpinBox.valueChanged.connect(self.co2Sensitivity)


        #tab4:
        self.upload1DirectoryButton.clicked.connect(self.upload1Directory)
        self.upload2DirectoryButton.clicked.connect(self.upload2Directory)
        self.logAnalysisCheckBox.clicked.connect(self.logAnalysis)
        self.runAnalysisButton.clicked.connect(self.ClickrunAnalysis)

        #tab6:
        self.uploadScrubbingButton.clicked.connect(self.fileNew)
        self.scrubbingPushButton.clicked.connect(self.RunScubbingSimulation)

        #Tab7:

        #self.tdiHalfGapEdit.textChanged.connect(self.updateHalfGap)
        #self.tdiRadioButton.connect(self.setTDIOption)
        #self.TDISUseTotalQCheckBox.stateChanged.connect(self.UseTotalOutgassing)
        self.TDISPushButton.clicked.connect(self.runTDISSimulation)



    def h2Visible(self):
        """
        Makes the H2 curve visible if the H2 check-button in the tab 'Data' is checked.
        :return: None
        """
        if self.h2CheckBox.isChecked():
            self.plotH2.setData(x = Density.X,y = Density.H2)
        else: self.plotH2.setData(x = [], y = [])
        self.l.update()

    def ch4Visible(self):
        """
        Makes the CH4 curve visible in the results of tab 'Simulation' if the CH4 check-button in the tab 'Data' is checked.
        :return: None
        """
        if self.ch4CheckBox.isChecked(): self.plotCH4.setData(x = Density.X, y = Density.CH4)
        else: self.plotCH4.setData(x = [], y = [])
        self.l.update()

    def coVisible(self):
        """
        Makes the CO curve visible in the results of tab 'Simulation' if the CO check-button in the tab 'Data' is checked.
        :return: None
        """
        if self.coCheckBox.isChecked(): self.plotCO.setData(x = Density.X, y = Density.CO)
        else: self.plotCO.setData(x = [], y = [])
        self.l.update()

    def co2Visible(self):
        """
        Makes the CO2 curve visible in the results of tab 'Simulation' if the CO2 check-button in the tab 'Data' is checked.
        :return: None
        """
        if self.co2CheckBox.isChecked(): self.plotCO2.setData(x = Density.X, y = Density.CO2)
        else: self.plotCO2.setData(x = [], y = [])
        self.l.update()

    def totalVisible(self):
        """
        Makes the total pressure curve visible in the results of tab 'Simulation' if the 'Total of all gas species' check-button in the tab 'Data' is checked.
        The total pressure is computed according to the values of the sensitivity factors for each specie selected in the 'Data' tab of PyVASCO.
        :return: None
        """
        if self.totalCheckBox.isChecked():
            total_Density = Density.total()
            self.plot_total.setData(x = Density.X, y = total_Density)
        else: self.plot_total.setData(x = [], y = [])
        self.l.update()

    def h2Sensitivity(self):
        """
        Sets the value for the sensitivity factor of H2 for conversion between molecules density and pressure.
        :return: None
        """
        Density.H2 = [x * self.h2SpinBox.value() for x in Density.H2]
        if self.h2CheckBox.isChecked(): self.plotH2.setData(x = Density.X, y = Density.H2)
        self.l.update()

    def ch4Sensitivity(self):
        """
        Sets the value for the sensitivity factor of CH4 for conversion between molecules density and pressure.
        :return: None
        """
        Density.CH4 = [x * self.ch4SpinBox.value() for x in Density.CH4]
        if self.ch4CheckBox.isChecked(): self.plotCH4.setData(x = Density.X, y = Density.CH4)
        self.l.update()

    def coSensitivity(self):
        """
        Sets the value for the sensitivity factor of CO for conversion between molecules density and pressure.
        :return: None
        """
        Density.CO = [x * self.coSpinBox.value() for x in Density.CO]
        if self.coCheckBox.isChecked(): self.plotCO.setData(x = Density.X, y = Density.CO)
        self.l.update()

    def co2Sensitivity(self):
        """
        Sets the value for the sensitivity factor of CO2 for conversion between molecules density and pressure.
        :return: None
        """
        Density.CO2 = [x * self.co2SpinBox.value() for x in Density.CO2]
        if self.co2CheckBox.isChecked(): self.plotCO2.setData(x = Density.X, y = Density.CO2)
        self.l.update()

    def setESDFromDose(self):
        """

        :return: None
        """
        self.esdFromDoseInfo.setText('1.0e' + str(self.esdFromDoseSlider.value()))
        self.eDose = float('1.0e' + str(self.esdFromDoseSlider.value()))
        if self.esdFromDoseCheckBox.isChecked():
            self.getESDFromDose()
        else:
            Config.UpdateESD = False

    def getESDFromDose(self):
        """
        Gets the ESD of a certain material given an approximated electron dose
        :return:
        """
        #newESD = ESD(self.eDose)
        Config.eDose = self.eDose
        Config.UpdateESD = True

    def runTDISSimulation(self):
        """
        Runs the simulation on the TDIS and plots the result in the tab 'TDIS'. See the user manual for more details.
        :return: None
        """
        try:
            Current = float(self.TDISBeamCurrentEdit.text())
        except:
            QMessageBox.warning(self, "Invalid value for Beam Current", "Beam Current must be a number!", QMessageBox.Ok)
        if self.TDISScrubbingRadioButton.isChecked():
            halfGapRange, data= PressureRiseDifferentSEY.runTDISSimulation(Current)
            print("Config.uploadElectronFluxFromSEY", Config.uploadElectronFluxFromSEY)

        elif self.TDISCaseStudyRadioButton.isChecked():
            halfGapRange,data = PressureRiseDifferentSEY.runTDISSimulation_nonHomogeneousSEY(Current)
        else:
            raise ValueError("Check one of the two simulation options! ")
        self.TDISPlot(halfGapRange, data)

    def ClickrunAnalysis(self):
        """
        When clicked, changes the text of the button 'Run Simulation' in Tab 'Data' to 'Running' and raises a warning
        message in case of unsuccessful simulation.
        :return: None
        """
        self.runAnalysisButton.setText('Runnning...')
        flag = Analysis.runAnalysis(self, Config.Upload1, Config.Upload2)
        if flag == False:
            QMessageBox.warning(self, "Unsuccessful!", "Unsuccessful Analysis: Please check your input format!", QMessageBox.Ok)
        self.runAnalysisButton.setText('Run Analysis')


    def RunScubbingSimulation(self):
        """
        Runs the simulation on the Scrubbing effect and plots the result in the tab 'Scrubbing Simulation'. See the user manual for more details.
        :return: None

        """

        self.scrubbingPushButton.setText("Running...")
        print('\n', '++++++++++++++++++++++++++++++++++++++++++++++++++++', '\n',
             '++++++++++++ SCRUBBING SIMULATION STARTED +++++++++++++++', '\n',
             '++++++++++++++++++++++++++++++++++++++++++++++++++++', '\n')
        QApplication.processEvents()
        current_set = float(self.currentEdit.text())
        # total_length needs to be caluclated for positioning the object in the scene
        total_length = 0

        eDoseRange, listDensity = Scrubbing.runSimulation(current_set)

        self.scrubbingPushButton.setText('Start Simulation')
        self.ScrubbingPlot(eDoseRange, listDensity)


    def ScrubbingPlot(self,eDoseRange, listDensity):
        """
        Plots the result of the Scrubbing Simulation. \n
        Parameters:
        ----------
        :param eDoseRange: (list) Simulated values of received electron dose.
        :param listDensity: (list) Density profile for the different simulated electron doses.
        :return None:
        """
        print('Scrubbing Plot')
        X = listDensity[0].X
        n = len(listDensity) - 1
        try:
            print(self.names)
            for t in self.names:
                self.scrubbingLegend.removeItem(t)
            self.names = []
            self.plotScrubbing1.setData(x=[], y=[])
            self.plotScrubbing2.setData(x=[], y=[])
            self.plotScrubbing3.setData(x=[], y=[])
            self.plotScrubbing4.setData(x=[], y=[])
            self.plotScrubbing5.setData(x=[], y=[])
        except:
            self.names = []

        print(n)
        # print("ListCurrents = ", listCurrent[0],listCurrent[int(n / 3)],listCurrent[int(2*n / 3)],listCurrent[n])

        self.plotScrubbing1.setData(x=X, y=listDensity[0].total())
        self.scrubbingLegend.addItem(self.plotScrubbing1, name=" " + str(eDoseRange[0]) + " e/cm^2")
        self.names.append(" " + str(eDoseRange[0]) + " e/cm^2")

        self.plotScrubbing2.setData(x=X, y=listDensity[int(n / 4)].total())
        self.scrubbingLegend.addItem(self.plotScrubbing2, name=" " + str(eDoseRange[int(n / 4)]) + " e/cm^2")
        self.names.append(" " + str(eDoseRange[int(n / 4)]) + " e/cm^2")

        self.plotScrubbing3.setData(x=X, y=listDensity[int(2 * n / 4)].total())
        self.scrubbingLegend.addItem(self.plotScrubbing3, name=" " + str(eDoseRange[int(2 * n / 4)]) + " e/cm^2")
        self.names.append(" " + str(eDoseRange[int(2 * n / 4)]) + " e/cm^2")

        self.plotScrubbing4.setData(x=X, y=listDensity[int(3*n/4)].total())
        self.scrubbingLegend.addItem(self.plotScrubbing4, name=" " + str(eDoseRange[int(3*n/4)]) + " e/cm^2")
        self.names.append(" " + str(eDoseRange[int(3*n/4)]) + " e/cm^2")

        self.plotScrubbing5.setData(x=X, y=listDensity[n].total())
        self.scrubbingLegend.addItem(self.plotScrubbing5, name=" " + str(eDoseRange[n]) + " e/cm^2")
        self.names.append(" " + str(eDoseRange[n]) + " e/cm^2")

    def TDISPlot(self,halfGapRange, data):
        """
        Plots the result of the TDIS Simulation. \n
        Parameters:
        -----------
        :param halfGapRange: (list) : List of Half-Geps considered in the simulation. See the user manual for more details.
        :param data: Maximum pressure as a function of the Half-Gap for different simulated SEY. See the user manual for more details.
        :return:
        """
        print("TDIS plot")
        try:
            print(self.names)
            for t in self.names:
                self.critLegend.removeItem(t)
            self.names = []
            self.plotTDIS1.setData(x=[], y=[])
            self.plotTDIS2.setData(x=[], y=[])
            self.plotTDIS3.setData(x=[], y=[])
            self.plotTDIS4.setData(x=[], y=[])
            self.plotTDIS5.setData(x=[], y=[])
        except:
            self.names = []

        n = len(data.keys()) - 1
        keys = data.keys()
        print( "SEY values",keys)
        self.plotTDIS1.setData(x=halfGapRange,y=data[keys[0]])
        self.TDISLegend.addItem(self.plotTDIS1, name= str(keys[0]))
        self.names.append(str(keys[0]))

        self.plotTDIS2.setData(x=halfGapRange, y=data[keys[1]])
        self.TDISLegend.addItem(self.plotTDIS2, name= str(keys[1]))
        self.names.append(str(keys[1]))

        self.plotTDIS3.setData(x=halfGapRange, y=data[keys[2]])
        self.TDISLegend.addItem(self.plotTDIS3, name= str(keys[2]))
        self.names.append("SEY " + str(keys[2]))

        self.plotTDIS4.setData(x=halfGapRange, y=data[keys[3]])
        self.TDISLegend.addItem(self.plotTDIS4, name= str(keys[3]))
        self.names.append("SEY " + str(keys[3]))

        self.plotTDIS5.setData(x=halfGapRange, y=data[keys[4]])
        self.TDISLegend.addItem(self.plotTDIS5, name= str(keys[4]))
        self.names.append(str(keys[4]))

        #self.plotTDIS6.setData(x=halfGapRange, y=data[keys[5]])
        #self.TDISLegend.addItem(self.plotTDIS6, name= str(keys[5]))
        #self.names.append("SEY " + str(keys[5]))


    def create_actions(self):
        """
        Creates the different actions in the Menu.
        :return: None
        """
        print('createActions')
        #File
        fileLoadAction = self.createAction("&Load...", self.fileLoad, "Ctrl+L")
        #fileExternalAction = self.createAction("&External Data", self.fileExternal, "Ctrl+E")
        filePropertiesAction = self.createAction("&Properties",self.fileProperties, "Ctrl+P" )
        fileQuitAction = self.createAction("&Quit", self.close,"Ctrl+Q")

        fileMenu = self.menuBar().addMenu("File")
        fileMenuActions = (fileLoadAction,  filePropertiesAction, None, fileQuitAction) #fileExternalAction,
        self.addActions(fileMenu, fileMenuActions)



        #Add
        addInputAction = self.createAction("&Input file", self.inputNew, "Ctrl+I" )
        addMaterialAction = self.createAction("&Material", self.materialNew, "Ctrl+M" )
        addPumpAction = self.createAction("&Pump",self.pumpNew, "Ctrl+P" )
        addGassourceAction = self.createAction("&Gassource", self.gassourceNew,"Ctrl+G")
        addESDCurve = self.createAction("&ESD curve", self.ESDcurveNew,"Ctrl+D")
        #addSEYCurve = self.createAction("&SEY curve", self.SEYcurveNew, "Ctrl+Y")


        addInputMenu = self.menuBar().addMenu("Add")
        addInputMenuActions = (addInputAction,addMaterialAction, addPumpAction, addGassourceAction,addESDCurve)#,addSEYCurve)
        self.addActions(addInputMenu, addInputMenuActions)

        #Help
        helpMenu = self.menuBar().addMenu("Help")
        helpUsersGuide = self.createAction("&User's guide",self.openUserGuide,"Ctrl+H")
        helpDocumentation = self.createAction("&Documentation",self.openDocumentation, "Ctrl+U")
        helpMenuActions = (helpUsersGuide,helpDocumentation)
        self.addActions(helpMenu,helpMenuActions)



    #Functions needed for creating connections to button

    def PressureDensity(self):
        """
        Changes the results presented in the the tab 'Simulation' from density to pressure and  back
        :return: None
        """
        print('PressureDensity')
        den=Density.transformation([float(self.h2SpinBox.value()), float(self.ch4SpinBox.value()), float(self.coSpinBox.value()), float(self.co2SpinBox.value())])
        labelStyle = {'color': '#FFF', 'font-size': '14pt'}
        if Density.density == True:
            self.densityPlotWidget.setLabel('left', "Density", units='particles/m3', **labelStyle)
        else:
            self.densityPlotWidget.setLabel('left', "Pressure", units='mbar', **labelStyle)
        self.updatePlot(den)

    def ShiftXAxis(self):
        """
        Shifts the X axis in the 'Simulation' tab
        :return:
        """
        print('ShiftXAxis')
        shift= self.shiftEdit.text()
        if shift=="":
            shift="0"
        try:
            shift=float(shift)
            for i in range(len(Density.X)):
                Density.X[i]+= shift
        except:
            QMessageBox.warning(self, "Unsuccessful shift of x-axis", "Unsuccessful shift of x-axis: Please check your value!", QMessageBox.Ok)




    def oldfileDirectory(self):
        """
        """
        print('oldFileDirectory')
        self.uploadEdit.setText('')
        dir = (os.path.dirname(Config.DataFolder+'Input_old/'))# if self.filename is not None else Config.DataFolder+'Input/')
        fname = unicode(QFileDialog.getOpenFileName(self,"Choose CSV-file in old input format", dir))
        parts=fname.split('/')
        self.transformEdit.setText(parts[-1])
        self.nameEdit.setText(parts[-1][:-4])
        Config.OldDataFile=fname


    def fileLoad(self):
        """
        Loads Materials, Pumps and Gas sources
        :return: None
        """
        print('fileLoad: Reload Materials, Pumps, Gassources')
        Config.Load()

        QMessageBox.information(self, "Load...", "Material, Pumps and Gassources have beeen reloaded! " , QMessageBox.Ok)

    def fileExternal(self):

        self.ex = ExternalDataWindow.ExDataWindow()
        self.ex.show()

    def fileProperties(self):
        """
        Launches the Property Window
        :return: None
        """
        self.ex = PropertyWindow.PropWindow()
        self.ex.show()

    def upload1Directory(self):
        """

        """
        print('uploadDirectory1')
        dir = (os.path.dirname(Config.DataFolder+'Output/'))
        fname = unicode(QFileDialog.getOpenFileName(self,"Choose CSV-file", dir))
        parts=fname.split('/')
        self.upload1DirectoryLabel.setText(parts[-1])
        Config.Upload1=fname

    def upload2Directory(self):
        """

        """
        print('uploadDirectory2')
        dir = (os.path.dirname(Config.DataFolder+'Output/'))
        fname = unicode(QFileDialog.getOpenFileName(self,"Choose CSV-file", dir))
        parts=fname.split('/')
        self.upload2DirectoryLabel.setText(parts[-1])
        Config.Upload2=fname


    def fileNew(self):
        """
        Sets the simulation Data file.
        """
        print('fileNew')
        dir = (os.path.dirname(Config.DataFolder+'Input/'))# if self.filename is not None else Config.DataFolder+'Input/')
        fname = unicode(QFileDialog.getOpenFileName(self,"Choose CSV-file", dir))
        parts=fname.split('/')
        self.uploadEdit.setText(parts[-1])

        self.nameEdit.setText(parts[-1][:-4])
        Config.DataFile=fname

    def gaugesUpload(self):
        """
        Loads Gauges data file.
        """
        dir = (os.path.dirname(Config.GaugesFolder))
        fname = unicode(QFileDialog.getOpenFileName(self,"Choose CSV-file", dir))
        parts=fname.split('/')
        self.gaugesEdit.setText(parts[-1])
        Config.GaugesFile=fname


    def logScale(self):
        """
        Sets logarithmic scale in the results plot of tab 'Simulation'.
        """
        if self.logCheckBox.isChecked():
            log = True
        else: log = False
        self.densityPlotWidget.setLogMode(False, log)

    def logAnalysis(self):
        """
         Sets logarithmic scale in the results plot of tab 'Analysis and Comparison'.
        """
        if self.logAnalysisCheckBox.isChecked():
            log = True
        else: log = False
        self.AnalysisPlotWidget.setLogMode(False, log)


    def PlottingQuality(self):
        """
        Sets number of points to be plotted in the pressure profile plot located in the tab 'Simulation'.
        """
        Config.NumPointsVacProfile = 30 * (self.plottingSlider.value() + 10)

    def inputNew(self):
        """
        Launches the 'New Input' window.
        """
        self.NewInputFile = NewInput.NewInputWindow()
        self.NewInputFile.show()

    def materialNew(self):
        """
        Launches the 'New Material' window.
        """
        self.MatNew = NewMaterialWindow.NewMatWindow()
        self.MatNew.show()

    def pumpNew(self):
        """
       Launches the 'New Pump' window.
       """
        self.PumpNew = NewPumpWindow.NewPumpWindow()
        self.PumpNew.show()

    def gassourceNew(self):
        """
        Launches the 'New Gas source' window.
        """
        self.GasSNew = NewGasSourceWindow.NewGSourceWindow()
        self.GasSNew.show()

    def ESDcurveNew(self):
        """
        Launches the 'New ESD curve' window.
        """
        self.ESDcurveNew = NewESDcurve.NewESDWindow()
        self.ESDcurveNew.show()

    def SEYcurveNew(self):
        """
        Launches the 'New SEY curve' window.
        """
        pass

    def openUserGuide(self):
        """
        Opens the User guide.
        """
        userGuideFile = Config.DocsFolder + "UserGuide.html"
        webbrowser.open(userGuideFile,new=2)

    def openDocumentation(self):
        """
        Opens the API documantation.
        """
        docFile = Config.DocsFolder + "Documentation.html"
        webbrowser.open(docFile, new=2)

    def saveDirectory(self):
        """
        Sets the name of the Output file of the simulation.
        """
        dir = self.saveEdit.text()

        fname = unicode(QFileDialog.getExistingDirectory(self,"Saving in...", dir))
        self.saveEdit.setText(fname)

    def updatePlot(self, density):
        """
        Updates the plot in the 'Simulation' tab.
        :param density: (DensityClass): Result of the simulation.
        """
        self.ShiftXAxis()
        if self.h2CheckBox.isChecked():
            self.plotH2.setData(x = density.X,y = density.H2)
            #self.Plot8.setData(x = density.X,y = density.H2)
        else: self.plotH2.setData(x = [], y = [])
        if self.ch4CheckBox.isChecked(): self.plotCH4.setData(x = density.X, y = density.CH4)
        else: self.plotCH4.setData(x = [], y = [])
        if self.coCheckBox.isChecked(): self.plotCO.setData(x = density.X, y = density.CO)
        else: self.plotCO.setData(x = [], y = [])
        if self.co2CheckBox.isChecked(): self.plotCO2.setData(x = density.X, y = density.CO2)
        else: self.plotCO2.setData(x = [], y = [])
        if self.totalCheckBox.isChecked(): self.plot_total.setData(x = density.X, y = density.total())
        else: self.plot_total.setData(x = [], y = [])
        self.l.update()

    def updateLHCData(self):
        """
        Adds the data from the Gauges file to 'Simulation' plot.
        """
        self.plot_Data.setData(x = [], y = [])
        self.plot_Data_blue.setData(x = [], y = [])
        vals = []
        if Config.GaugesFile == "":
            vals = []
        else:
            vals = Config.LoadLHCData(Config.GaugesFile)
            vals_blue = Config.LoadLHCData(Config.DataFolder+'Input/GaugesData/Gauges_5211_blue.csv')
        start = float(self.gaugesSpinbox.text())

        xvals = [row[0] - start for row in vals] #subtracting 12820.2 to match the coordinate systems...
        yvals = [row[1] for row in vals]
        yvals_max = [row[3] for row in vals]
        yvals_min = [row[2]  for row in vals]

        xvals_blue = [row[0] - start for row in vals_blue] #subtracting 12820.2 to match the coordinate systems...
        yvals_blue = [row[1] for row in vals_blue]
        yvals_max_blue = [row[3] for row in vals_blue]
        yvals_min_blue = [row[2]  for row in vals_blue]

        self.plot_Data = self.densityPlotWidget.plot(x= xvals , y= yvals, pen= None, symbol = 'o', symbolSize = 5, symbolPen = (255, 255, 255, 200), symbolBrush = (0,0,255,150))
        # self.plot_Data_blue = self.densityPlotWidget.plot(x= xvals_blue , y= yvals_blue, pen= None, symbol = '+', symbolSize = 5, symbolPen = (255, 255, 255, 200), symbolBrush = (0,0,255,150))
        self.l.update()

    def critCurrentPlot(self, listDensity,listCurrent):
        """
        Plot in the 'Critical Current' tab.
        :param listDensity: (list) List containing the density profile for the different simulated currents.
        :param listCurrent: (list) List with simulated beam currents.
        :return:
        """
        print('crit current Plot')
        print(listCurrent)
        X = listDensity[0].X
        n = len(listDensity) - 1
        try:
            print(self.names)
            for t in self.names:
                self.critLegend.removeItem(t)
            self.names = []
            self.plotCurrent1.setData(x=[], y=[])
            self.plotCurrent2.setData(x=[], y=[])
            self.plotCurrent3.setData(x=[], y=[])
            self.plotCurrent4.setData(x=[], y=[])
        except:
            self.names = []

        print(n)
        #print("ListCurrents = ", listCurrent[0],listCurrent[int(n / 3)],listCurrent[int(2*n / 3)],listCurrent[n])
        if n >= 3:

            self.plotCurrent1.setData(x = X, y = listDensity[0].total())
            self.critLegend.addItem(self.plotCurrent1,name=" " + str(listCurrent[0]) + " A")
            self.names.append(" " + str(listCurrent[0]) + " A")

            self.plotCurrent2.setData(x = X, y = listDensity[int(n / 3)].total())
            self.critLegend.addItem(self.plotCurrent2, name=" " + str(listCurrent[int(n / 3)]) + " A")
            self.names.append(" " + str(listCurrent[int(n / 3)]) + " A")

            self.plotCurrent3.setData(x = X, y = listDensity[int(2 * n / 3)].total())
            self.critLegend.addItem(self.plotCurrent3, name=" " + str(listCurrent[int(2*n / 3)]) + " A")
            self.names.append(" " + str(listCurrent[int(2*n / 3)]) + " A")

            self.plotCurrent4.setData(x = X, y = listDensity[n].total())
            self.critLegend.addItem(self.plotCurrent4, name=" " + str(listCurrent[n]) + " A")
            self.names.append(" " + str(listCurrent[n]) + " A")

        elif n == 2:
            self.plotCurrent1.setData(x=X, y=listDensity[0].total())
            self.critLegend.addItem(self.plotCurrent1, name=" " + str(listCurrent[0]) + " A")
            self.names.append(" " + str(listCurrent[0]) + " A")

            self.plotCurrent2.setData(x=X, y=listDensity[1].total())
            self.critLegend.addItem(self.plotCurrent2, name=" " + str(listCurrent[1]) + " A")
            self.names.append(" " + str(listCurrent[1]) + " A")

            self.plotCurrent3.setData(x=X, y=listDensity[2].total())
            self.critLegend.addItem(self.plotCurrent3, name=" " + str(listCurrent[2]) + " A")
            self.names.append(" " + str(listCurrent[2]) + " A")

        else:
            self.plotCurrent1.setData(x=X, y=listDensity[0].total())
            self.critLegend.addItem(self.plotCurrent1, name=" " + str(listCurrent[0]) + " A")
            self.names.append(" " + str(listCurrent[0]) + " A")

            self.plotCurrent2.setData(x=X, y=listDensity[-1].total())
            self.critLegend.addItem(self.plotCurrent2, name=" " + str(listCurrent[1]) + " A")
            self.names.append(" " + str(listCurrent[-1]) + " A")

        #self.plotCurrent5.setData(x=X, y=listDensity[n + 1].total())
        #self.critLegend.addItem(self.plotCurrent5, name=" " + str(listCurrent[n + 1]) + " A")
        #self.names.append(" " + str(listCurrent[n+1]) + " A")






    def runSimulation(self):
        """
        Runs main simulation and plots the results in the 'Simulation' tab.
        """

        if self.ThreeDCheckBox.isChecked():
            # 3d plotting 
            w = gl.GLViewWidget()
            w.show()
            w.setWindowTitle('3d sketch')
            w.setCameraPosition(distance=50)
            w.resize(800,600)
            w.setBackgroundColor('w')
            #w.setWindowState(qt.windowmaximized); 




        print('\n', '++++++++++++++++++++++++++++++++++++++++++++++++++++', '\n',
              '++++++++++++ NEW SIMULATION STARTED +++++++++++++++', '\n',
              '++++++++++++++++++++++++++++++++++++++++++++++++++++', '\n')

        self.geometryPlotWidget.clear()
        self.densityRadioButton.click()
        Config.setMass([float(self.massEdit1.text()), float(self.massEdit2.text()), float(self.massEdit3.text()), float(self.massEdit4.text())])
        Config.setCrossSection([float(self.crossSectionEdit1.text()), float(self.crossSectionEdit2.text()), float(self.crossSectionEdit3.text()), float(self.crossSectionEdit4.text())])
        Config.TotalOutgassingForMaterials = self.TotalOutgassingMaterials.text().split(",")
        self.runsimulationButton.setText('Running...')
        self.logScale()
        QApplication.processEvents()


        Segments, EndPump, EndSource, DivisionList, GeometryParameters = GetSegments(Config.DataFile)

        #total_length needs to be caluclated for positioning the object in the scene
        total_length = 0
        try:    GeometryParameters[0]
        except TypeError:
            QMessageBox.warning(self, "ERROR in Input Parameters", "Please define the Input parameter correctly! Did you set the parameter name in the file? Do you have to change the input folder?", QMessageBox.Ok)
            return
        for segment in GeometryParameters:
            #DivisionsList
            try:
                seg_length = float(segment[0])/1000.
                total_length += seg_length
            except:
                break



        #Segments2, EndPump2, EndSource2, DivisionList2, GeometryParameters2 = GetSegments(Config.DataFile2)   #second beam line
        if Segments == False:
            QMessageBox.warning(self, "ERROR in Input Parameters", "Please define the Input parameter correctly! Could not find item: " + str(EndPump) , QMessageBox.Ok)
            self.runsimulationButton.setText('Run Simulation')
            return
        print('number of segment', len(Segments))

        if not Segments:
            QMessageBox.warning(self, "ERROR: No File uploaded!", "Please upload a file with the input parameters!", QMessageBox.Ok)
            self.uploadEdit.setFocus()
            self.runsimulationButton.setText('Run Simulation')
            return

        #DENSITY PLOT
        current_set = float(self.currentEdit.text())
        den = Calculate(Segments, EndPump, EndSource, current_set)


        if den == []:
            QMessageBox.warning(self, "ERROR in Input Parameters", "Ill-posed matrix equations lead to unsolveable system. Please define the Input parameters correctly!"  , QMessageBox.Ok)
            self.runsimulationButton.setText('Run Simulation')
            return
        try: den.H2
        except:
            QMessageBox.warning(self, "ERROR in Input Parameters", "Please define the Input parameter correctly! Could not find item: "+ str(den) , QMessageBox.Ok)
            self.runsimulationButton.setText('Run Simulation')
            return
        Density.setDensity(den)
        Density.setTemperatureProfile(den.Temperature)
        self.updatePlot(Density)
        self.updateLHCData()
        #x,y= UploadData(Config.DataFolder+'Input/Roberto.txt' )
        #self.densityPlotWidget.plot(x,y)

        #Geometry
        l0 =self.shiftEdit.text()
        if l0 == "":
            l0="0"
        l0=float(l0)
        help_vertical = 0
        LegendMaterialDict= {}
        b_old = 0




        for segment in GeometryParameters:
            #DivisionsList
            try: l=float(segment[0])/1000.
            except: break
            b=float(segment[1])/1000.
            material=segment[2]
            temperature = float(segment[3])

            if temperature < 100:
                rect_magnet = QGraphicsRectItem(QRectF(l0, -0.15, l, 0.3))
                rect_magnet.setPen(QPen(Config.ColorPalette['LightGray']))
                rect_magnet.setBrush(QBrush(Config.ColorPalette['LightGray']))
                self.geometryPlotWidget.addItem(rect_magnet)


            #if l0 < 367.064:
            #    help_vertical = 0.07
            #elif l0 > 655.39:   help_vertical = -0.07            
            #else: help_vertical = 0
            rect=QGraphicsRectItem(QRectF(l0, -b/2+ help_vertical, l, b))
            rect.setPen(QPen(Config.ColorPalette['LightGray']))
            #rect.opaqueArea(QPen(Config.ColorPalette['Red']))  #QPen(Config.ColorPalette['Red'])

            rect.setBrush(QBrush(
                Config.MaterialColorDict[material]
                ))
            l0+=l

            self.geometryPlotWidget.addItem(rect)
            LegendMaterialDict[material] = Config.MaterialColorDict[material]

            ## 3D Plotting 
            if self.ThreeDCheckBox.isChecked():
                md_help = gl.MeshData.cylinder(rows=10, cols=20, radius=[50.*b_old, 50.*b], length=0.01)
                md = gl.MeshData.cylinder(rows=10, cols=20, radius=[50.*b, 50.*b], length=l-0.01)
                b_old = b
                m_help = gl.GLMeshItem(meshdata=md_help, smooth=True, color=Config.MaterialColorDict[material],shader='shaded', glOptions='translucent')
                m1 = gl.GLMeshItem(meshdata=md, smooth=True, color=Config.MaterialColorDict[material],shader='shaded', glOptions='translucent')

                m_help.translate(0,0,l0-l-total_length*0.5)
                m_help.rotate(90., 1., 0., 0.)
                m1.translate(0,0,l0-l+0.01-total_length*0.5)
                m1.rotate(90., 1., 0., 0.)
                w.addItem(m_help)
                w.addItem(m1)
                # Save plot
                d = w.renderToArray((1000, 1000))
                filename = str(self.nameEdit.text()) + ".png"
                pg.makeQImage(d).save(filename)


        ###############################
#        l0=self.shiftEdit.text()
#        if l0 == "":
#            l0="0"
#        l0=float(l0)

#        for segment in GeometryParameters2:
#            #DivisionsList
#            try: l=float(segment[0])/1000
#            except: break
#            b=float(segment[1])/1000
#            material=segment[2]
#            temperature = float(segment[3])
#            print(l0)
#            if not(367.064 <= l0 <= 655.39):
#                if l0 < 367.064:
#                    help_vertical = -0.07
#                else:
#                    help_vertical = 0.07
#                rect=QGraphicsRectItem(QRectF(l0, -b/2 + help_vertical, l, b))
#                rect.setPen(QPen(Config.ColorPalette['LightGray']))
#                #rect.opaqueArea(QPen(Config.ColorPalette['Red']))  #QPen(Config.ColorPalette['Red'])

#                rect.setBrush(QBrush(
#                    Config.MaterialColorDict[material]
#                    ))


#                self.geometryPlotWidget.addItem(rect)
#                LegendMaterialDict[material] = Config.MaterialColorDict[material]
#            l0+=l

#############################3




        for element in LegendMaterialDict:
            print("LegendMaterialDict[element]",LegendMaterialDict[element]," element", element)
            self.geometryPlotWidget.plot(pen=LegendMaterialDict[element], name=element)


        if self.savetxtCheckBox.isChecked():
            self.saveFile([Density.X,Density.H2, Density.CH4, Density.CO, Density.CO2])
        self.runsimulationButton.setText('Run Simulation')
        if self.currentCheckBox.isChecked(): self.critCurrent2() #self.critCurrent()
        #checks if log-button is checked or not
        if self.savepngCheckBox.isChecked():
            self.take_screenshot()
            vals =  np.hstack([np.random.normal(size=100), np.random.normal(size=260, loc=4)])
            y = pg.pseudoScatter(vals, spacing=0.15)

            self.l.update()
        if self.ThreeDCheckBox.isChecked():
            w.grabFrameBuffer().save('3DPlot.png')

    def runSimulation3(self):

        self.geometryPlotWidget.clear()
        self.densityRadioButton.click()
        Config.setMass([float(self.massEdit1.text()), float(self.massEdit2.text()), float(self.massEdit3.text()), float(self.massEdit4.text())])
        Config.setCrossSection([float(self.crossSectionEdit1.text()), float(self.crossSectionEdit2.text()), float(self.crossSectionEdit3.text()), float(self.crossSectionEdit4.text())])
        self.runsimulationButton.setText('Running...')
        self.logScale()
        QApplication.processEvents()
        Segments, EndPump, EndSource, DivisionList, GeometryParameters = GetSegments(Config.DataFile)

    def transformInput(self):
        """
        Transforms a CSV file written  with VASCO's input format into the new format for PyVASCO. See user manual for more information.
        """
        print('transformation Input')
        dir=Config.OldDataFile
        isTransformed= Main_Material_Transformation(dir)
        if isTransformed:
            dir = Config.DataFile
            parts=dir.split('/')
            #self.oldFormatFilePath=dir
            self.uploadEdit.setText(parts[-1])
            Config.DataFile=dir
            help=Config.CrossSection
            self.crossSectionEdit1.setText(str(help[0]))
            self.crossSectionEdit2.setText(str(help[1]))
            self.crossSectionEdit3.setText(str(help[2]))
            self.crossSectionEdit4.setText(str(help[3]))
            Config.Load() #Load material/pump/gassource again
        else:
            QMessageBox.warning(self, "ERROR: OldInput to new format was unsuccessful!", 'Could not open file! It exists already. Please close it and it will be overwritten then! ', QMessageBox.Ok)

    def critCurrent(self):
        """
        Computes the critical current for a given geometry.
        """
        print('crit Current')
        self.runsimulationButton.setText('Running...')
        self.critCurrentLabel.setText("Critical Current: not determined!")
        QApplication.processEvents()
        Segments, EndPump, EndSource, DivisionList, GeometryParameters  = GetSegments(Config.DataFile)
        #print("Segments", Segments)

        if Segments == False:
            QMessageBox.warning(self, "ERROR in Input Parameters", "Please define the Input parameter correctly! Could not find item: "+ str(EndPump) , QMessageBox.Ok)
            return

        if not Segments:
            QMessageBox.warning(self, "ERROR: No File uploaded!", "Please upload a file with the input parameters!", QMessageBox.Ok)
            self.uploadEdit.setFocus()
            self.runsimulationButton.setText('Run Simulation')
            return

        #DENSITY PLOT

        #den = Calculate(Segments,EndPump, EndSource, Current=float(self.currentEdit.text()))

                #DENSITY PLOT
        initialCurrent = float(self.initialcurrentSpinBox.value())
        if initialCurrent == 0:
            initialCurrent = 1.0e-6

        endCurrent = float(self.endcurrentSpinBox.value())
        steps = int(self.stepscurrentSpinBox.value()) # number of simulations between initial current and end current

        ################################# CALCULATION OF THE CRITICAL CURRENT ####################################
        # 1.- Use bisection method to detect if the density becomes negative inside the selected range of values.
        # 2.- Determine the greatest value of I which gives place to positive mean density in its maximum at I0 = 1e-6 A.
        # 3.- Reset precission and move from the previously determined point to greater currents until a divergence in n
        # of the order of 1e6 times the value of n in the previous step.
        # 4.- Also quit if negative value in n is found and give the last I which gave positive n as Ic.
        # 5.- If no negative values in the interval...

        helpCurrent = 1.0e-6 # No beam. It is not set to 0 to avoid numerical problems
        try:
            raise Warning("Density profile at I = 0 A not determined!! Using InitialCurrent")
            DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent)
            maxInitialDensity = max(DensityProfile.total())
            xIndex = np.argmax(DensityProfile.total())
        except:
            DensityProfile = Calculate(Segments, EndPump, EndSource, Current=initialCurrent)

        try:
            DensityProfile.H2
            maxInitialDensity = max(DensityProfile.total())
            xIndex = np.argmax(DensityProfile.total())
        except:
            QMessageBox.warning(self, "ERROR in Input Parameters",
                                "Please define the Input parameter correctly! Could not find item: " + str(
                                    DensityProfile), QMessageBox.Ok)
            self.runsimulationButton.setText('Run Simulation')
            return

        listCurrent = [helpCurrent]
        listDensity = [DensityProfile]
        CritCurrent = None
        tol = 0.01 # A
        precision = (endCurrent - initialCurrent)/steps # A
        tol = precision*0.01
        bisec = True

        i = 0
        tmpCurrent = 0
        negatives = 0
        while i < steps:
            i+=1
            print("Step", i, "initialCurrent=", initialCurrent, "endCurrent=", endCurrent)
            helpCurrent = abs(endCurrent + initialCurrent) * 0.5
            print("Help current", helpCurrent)
            DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent)
            try:
                print("aDensityProfile.CH4[xIndex] < 0", DensityProfile.CH4[xIndex] < 0, "DensityProfile.H2[xIndex] < 0",
                      DensityProfile.H2[xIndex] < 0, "DensityProfile.CO2[xIndex] < 0", DensityProfile.CO2[xIndex] < 0)
                if DensityProfile.CH4[xIndex] < 0 or DensityProfile.H2[xIndex] < 0 or DensityProfile.CO[xIndex] < 0 or \
                                DensityProfile.CO2[xIndex] < 0:
                    print("Negative density profile !!!!!! This means that we have gone over the critical density")
                    negatives += 1
                    endCurrent = helpCurrent
                else:
                    if negatives > 0:
                        initialCurrent = helpCurrent
                        precision = (endCurrent - 1 - initialCurrent) / steps
                    break
            except:
                pass
        else:
            print("Critical Current <= ", helpCurrent)

        for i in range(steps):
            print("Step", i, "initialCurrent=", initialCurrent, "endCurrent=", endCurrent)
            helpCurrent = initialCurrent + precision * i
            print(i, "HelpCurrent", helpCurrent)
            DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent)
            try:
                print(DensityProfile.total()[xIndex]/ listDensity[-1].total()[xIndex])
                if DensityProfile.total()[xIndex]/ listDensity[-1].total()[xIndex] > 1e3 : #* listDensity[-1].total()[ xIndex]: and DensityProfile.total()[xIndex] > 0:
                    CritCurrent = helpCurrent
                    print('Critical current determined at', CritCurrent)
                    self.critCurrentLabel.setText("Critical Current: " + str(CritCurrent) + " A")
                    break

                if DensityProfile.CH4[xIndex] < 0 or DensityProfile.H2[xIndex] < 0 or DensityProfile.CO[xIndex] < 0 or \
                                DensityProfile.CO2[xIndex] < 0:
                    maxCritDensity = DensityProfile.total()[xIndex]
                    CritCurrent = helpCurrent-precision

                    DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent - precision/2)
                    try:
                        if DensityProfile.CH4[xIndex] > 0 and DensityProfile.H2[xIndex] > 0 and DensityProfile.CO[xIndex] > 0 and \
                        DensityProfile.CO2[xIndex] > 0 and DensityProfile.total()[xIndex] > maxCritDensity:
                            CritCurrent = helpCurrent - precision/2
                            listCurrent.append(CritCurrent)
                            listDensity.append(DensityProfile)
                            print('Critical current determined at', CritCurrent)
                            self.critCurrentLabel.setText("Critical Current: " + str(CritCurrent) + " +- "+str(precision/2)+ " A")
                            break
                    except:
                        pass
                    print('Critical current determined at', CritCurrent)
                    self.critCurrentLabel.setText("Critical Current: " + str(CritCurrent) +" +- " + str(precision)+ " A")
                    break
                else:
                    if negatives > 0:
                        print('Critical current determined at', endCurrent)
                        self.critCurrentLabel.setText(
                            "Critical Current: " + str(endCurrent) + " +- " + str(precision) + " A")
                    else:
                        print("Critical Current >=", endCurrent)
                        self.critCurrentLabel.setText(
                            "Critical Current >= " + str(endCurrent) + " A")
                listCurrent.append(helpCurrent)
                listDensity.append(DensityProfile)
                #else:
                #    print("Critical Current >=", endCurrent)
            except:
                pass

        # Sort currents and corresponding density profiles in ascending order
        listCurrent,listDensity = zip(*sorted(zip(listCurrent,listDensity),key=lambda x: x[0]))
        listCurrent = list(listCurrent)
        listDensity = list(listDensity)
        print(listCurrent, type(listCurrent))
        # Plot the density for the different species where the density at I = 0 was maximum as a function of the current

        densityValue0 = []
        densityValue1 = []
        densityValue2 = []
        densityValue3 = []

        for element in listDensity:
            densityValue0.append(element.H2[xIndex])
            densityValue1.append(element.CH4[xIndex])
            densityValue2.append(element.CO[xIndex])
            densityValue3.append(element.CO2[xIndex])

        self.CurrentDyn1Plot.setData(x=listCurrent, y=densityValue0)
        self.CurrentDyn2Plot.setData(x=listCurrent, y=densityValue1)
        self.CurrentDyn3Plot.setData(x=listCurrent, y=densityValue2)
        self.CurrentDyn4Plot.setData(x=listCurrent, y=densityValue3)

        self.critCurrentPlot(listDensity, listCurrent)
        self.runsimulationButton.setText('Run Simulation')


        # Original Ida's algorithm
        '''
        current_stepsize = (endCurrent-int(initialCurrent))/steps
        print('current_stepsize', current_stepsize)

        helpCurrent=initialCurrent
        DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent)
        try: DensityProfile.H2
        except: 
            QMessageBox.warning(self, "ERROR in Input Parameters", "Please define the Input parameter correctly! Could not find item: "+ str(DensityProfile) , QMessageBox.Ok)
            self.runsimulationButton.setText('Run Simulation')
            return 
        listCurrent=[helpCurrent]
        listDensity=[DensityProfile]

        CritCurrent=0
        timesinif = 0
        for step in range(1,steps):
            #print("STEP : ", step)
            helpCurrent=initialCurrent+step*current_stepsize
            DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent)
            Residum=np.array(DensityProfile.total())-np.array(listDensity[-1].total())
            #print("RESIDUM",step,"=",Residum)
            #print("Min residum = ", min(Residum))
            if min(Residum) < 0:
                timesinif += 1
                CritCurrent = helpCurrent - current_stepsize
                self.critCurrentLabel.setText("Critical Current: " + str(CritCurrent) + " Ampere")
                #self.critCurrentLabel.setPalette(QPalette().setColor(QPalette.Foreground, QColor(255,80,80)))
                #break


            listCurrent.append(helpCurrent)
            listDensity.append(DensityProfile)

        print("listCurrent=",listCurrent)

        # Take the index of x , where the density assumes its maximum for hydrogen (h2 provides usually the highest density) 
        xIndex=np.argmax(listDensity[-1].H2) 
        xIndex+=2

        #max(xrange(len(listDensity[-1].H2)),key=listDensity[-1].H2.__getitem__)

        densityValue0=[]
        densityValue1=[]
        densityValue2=[]
        densityValue3=[]

        for element in listDensity:
            densityValue0.append(element.H2[xIndex])
            densityValue1.append(element.CH4[xIndex])
            densityValue2.append(element.CO[xIndex])
            densityValue3.append(element.CO2[xIndex])

        self.CurrentDyn1Plot.setData(x=listCurrent, y=densityValue0)
        self.CurrentDyn2Plot.setData(x=listCurrent, y=densityValue1)
        self.CurrentDyn3Plot.setData(x=listCurrent, y=densityValue2)
        self.CurrentDyn4Plot.setData(x=listCurrent, y=densityValue3)


        ##########Compare the density increase and DETERMINE THE CRITICAL CURRENT
        Density_0=listDensity[0].total()
        CritCurrent=0
        help=0
        for densityElement in listDensity:
            Density_1=densityElement.total()
            Residum=np.array(Density_1)-np.array(Density_0)
            if min(Residum) < 0:
                CritCurrent = listCurrent[help-1]
                break
            #print('Residum at current index ',current_value[help3], 'with value', max(abs(Residum)),'and', min(Residum))
            Density_0=Density_1
            help+=1    

        print('Critical current determined at',CritCurrent)
        self.critCurrentPlot(listDensity,listCurrent)
        self.runsimulationButton.setText('Run Simulation')
        '''

    def critCurrent2(self):
        """
        Implements computation of the Critical Current using the same algorithm used in VASCO. \n

        Description:
        ----------
         1.- Read values for Initial current (current from which the Ic is going to be computed), step (current
         increase between consecutive calculations), nsteps (maximum number of steps in the calculation) \n
         2.- Set maximum relative increase between 2 consecutive computations of the average density. Why in VASCO is
         set to Ic_step = tan(88/90*pi/2) ? \n
         3.- Conditions for finishing the computation: Relative increase in consecutive steps > Ic_step OR the
         minimum density for the gas with smaller density becomes negative OR  end of steps. \n
         4.- Check if the density decreases with respect to the previous step. If so, stop the calculation and raise a
         warning. \n

        """
        # Implements computation of the Critical Current using the same algorithm used in VASCO

        ##################################    CALCULATION OF THE CRITICAL CURRENT ######################################
        # 1.- Read values for Initial current (current from which the Ic is going to be computed), step (current
        # increase between consecutive calculations), nsteps (maximum number of steps in the calculation)
        # 2.- Set maximum relative increase between 2 consecutive computations of the average density. Why in VASCO is
        # set to Ic_step = tan(88/90*pi/2) ?
        # 3.- Conditions for finishing the computation: Relative increase in consecutive steps > Ic_step OR the
        # minimum density for the gas with smaller density becomes negative OR  end of steps.
        # 4.- Check if the density decreases with respect to the previous step. If so, stop the calculation and raise a
        # warning.

        print('crit Current')
        notDetermined = False
        self.runsimulationButton.setText('Running...')
        self.critCurrentLabel.setText("Critical Current: not determined!")
        QApplication.processEvents()
        Segments, EndPump, EndSource, DivisionList, GeometryParameters = GetSegments(Config.DataFile)
        # print("Segments", Segments)

        if Segments == False:
            QMessageBox.warning(self, "ERROR in Input Parameters",
                                "Please define the Input parameter correctly! Could not find item: " + str(EndPump),
                                QMessageBox.Ok)
            return

        if not Segments:
            QMessageBox.warning(self, "ERROR: No File uploaded!", "Please upload a file with the input parameters!",
                                QMessageBox.Ok)
            self.uploadEdit.setFocus()
            self.runsimulationButton.setText('Run Simulation')
            return

            # DENSITY PLOT

            # den = Calculate(Segments,EndPump, EndSource, Current=float(self.currentEdit.text()))

            # DENSITY PLOT
        initialCurrent = float(self.initialcurrentSpinBox.value())
        if initialCurrent == 0:
            initialCurrent = 1.0e-6

        precision = float(self.precisioncurrentSpinBox.value())
        steps = int(self.stepscurrentSpinBox.value())  # number of simulations between initial current and end current

        Ic_step = np.tan(88/90*np.pi*0.5)*1e3

        listDensity = [Calculate(Segments, EndPump, EndSource, Current=initialCurrent)]
        listCurrent = [initialCurrent]

        for step in range(1,steps+1):
            print("Step : ", step)
            # Compute the maximum of the average density for the initial current.
            helpCurrent = initialCurrent + precision * step
            print("HelpCurrent :", helpCurrent)
            print(step, "HelpCurrent", helpCurrent)
            DensityProfile = Calculate(Segments, EndPump, EndSource, Current=helpCurrent)

            print("max(np.array(DensityProfile.total()) - np.array(listDensity[-1].total()))/max(np.array(listDensity[-1].total())")
            print(max(np.array(DensityProfile.total()) - np.array(listDensity[-1].total())) / max(np.array(listDensity[-1].total())))

            if min([min(DensityProfile.H2),min(DensityProfile.CH4),min(DensityProfile.CO), min(DensityProfile.CO2)])< 0:
                print("Found negative density!")
                break

            elif max(np.array(DensityProfile.total()) - np.array(listDensity[-1].total()) ) < 0:
                print("Density decreases with increasing current!")
                break

            elif max(np.array(DensityProfile.total()) - np.array(listDensity[-1].total()))/max(np.array(listDensity[-1].total())) > Ic_step*precision :
                print("Critical current determined!")
                break

            listDensity.append(DensityProfile)
            listCurrent.append(helpCurrent)

        else:
            notDetermined = True
            print('Critical current not determined! ')
            self.critCurrentLabel.setText("Critical Current > " + str(helpCurrent) + " A")

        if step < 2:
            print('Warning: out of critical current loop at first step. Initial current value too high !!!!')
            QMessageBox.warning(self,'Warning: out of critical current loop at first step',' Initial current value too high !!!!' , QMessageBox.Ok)
            self.runsimulationButton.setText('Run Simulation')


        elif notDetermined is False:
            CritCurrent = helpCurrent - precision
            print('Critical current determined at', CritCurrent)
            self.critCurrentLabel.setText("Critical Current: " + str(CritCurrent) + " +- " + str(precision) + " A")

        # Plot the density for the different species where the density at I = 0 was maximum as a function of the
        #  current
        xIndex = np.argmax(listDensity[-1].H2)
        densityValue0 = []
        densityValue1 = []
        densityValue2 = []
        densityValue3 = []

        for element in listDensity:
            densityValue0.append(element.H2[xIndex])
            densityValue1.append(element.CH4[xIndex])
            densityValue2.append(element.CO[xIndex])
            densityValue3.append(element.CO2[xIndex])

        self.CurrentDyn1Plot.setData(x=listCurrent, y=densityValue0)
        self.CurrentDyn2Plot.setData(x=listCurrent, y=densityValue1)
        self.CurrentDyn3Plot.setData(x=listCurrent, y=densityValue2)
        self.CurrentDyn4Plot.setData(x=listCurrent, y=densityValue3)

        self.critCurrentPlot(listDensity, listCurrent)
        self.runsimulationButton.setText('Run Simulation')


    def saveFile(self,Array):
        """
        Saves the simulation results to CSV file in the directory indicated in the 'Data' tab under the label 'Save results in folder' \n

        Parameters:
        ----------
        :param Array: (numpy.ndarray) Array containing the density or pressure profile for the different considered species.
        """
        print('saveFile')
        #Array = [X, H2, CH4, CO, CO2] saves the values of array in a txt-file.
        fmtStrZone = "%d-%m-%Y_%H-%M-%S"
        utc = datetime.now(timezone('UTC'))
        if self.saveEdit.text()=='': self.saveEdit.setText(Config.VacProfileOutputFolder)
        dir = self.saveEdit.text()+ '\\' + self.nameEdit.text() +'_' + utc.strftime(fmtStrZone) + '.csv'
        #f=open(dir,'w+')
        try: f=open(dir,'w+')
        except IOError as e:
            QMessageBox.warning(self, "ERROR: Saving File -  Access denied!", "Read-Only Mode in this saving Directory! Please choose another directory or change the privacy properties! "  , QMessageBox.Ok)
            return
        f.write('X , H2, CH4, CO, CO2 \n')
        i=0
        while i<len(Array[0]):
            f.write(str(Array[0][i])+','+str(Array[1][i])+','+str(Array[2][i])+','+str(Array[3][i])+','+str(Array[4][i])+'\n')

            i+=1
        f.close()

    def take_screenshot(self):
        p = QPixmap.grabWindow(self.densityPlotWidget.winId())
        p.save(os.path.dirname(Config.DataFolder+'Output/')+'Screenshot.png', 'png',100)

    #interne Funktionen
    def initiateMainWindow(self):
        """
        Initializes the main window of PyVASCO.
        """

        list=[self.densityRadioButton, self.h2CheckBox, self.ch4CheckBox, self.coCheckBox, self.co2CheckBox, self.logCheckBox]
        for button in list:
            button.setChecked(True)

        self.nameEdit.setText("Unnamed")
        self.saveEdit.setText(os.path.dirname(Config.DataFolder+'Output/'))

    def checkallgas(self):
        """
        Selects the check-buttons of all gas species in the tab 'Data'

        """
        list=[self.h2CheckBox, self.ch4CheckBox, self.coCheckBox, self.co2CheckBox]
        if self.allgasCheckBox.isChecked():
            for button in list:
                button.setChecked(True)
                button.setDisabled(True)
        else:
            for button in list:
                button.setChecked(False)
                button.setDisabled(False)


    def okToContinue(self):
        pass
        '''
        if self.dirty:
            reply = QMessageBox.question(self,
                    "Image Changer - Unsaved Changes",
                    "Save unsaved changes?",
                    QMessageBox.Yes|QMessageBox.No|QMessageBox.Cancel)
            if reply == QMessageBox.Cancel:
                return False
            elif reply == QMessageBox.Yes:
                return self.fileSave()
        return True
        '''



    def createAction(self, text, slot=None, shortcut=None, icon=None,tip=None, checkable=False):
        """
        Creates an action in the Menu and vinculates a keyboard shortcut. \n
        Parameters:
        ----------
        :param text: (str) Name of the action.
        :param slot: (optional, str)
        :param shortcut: (str) Definition of the action's shortcut.
        :param icon: (optional, str) Name of the PNG icon for the action.
        :param tip: (optional, str) Short description of the action.
        :param checkable: (optional, bool) If True, makes the action checkable.

        """
        action = QAction(text, self)
        if icon is not None:
            action.setIcon(QIcon(":/{0}.png".format(icon)))
        if shortcut is not None:
            action.setShortcut(shortcut)
        if tip is not None:
            action.setToolTip(tip)
            action.setStatusTip(tip)
        if slot is not None:
            action.triggered.connect(slot)
        if checkable:
            action.setCheckable(True)
        return action

    def addActions(self, target, actions):
        """
        Adds actions to the targeted object. \n
        Parameters:
        -----------
        :param target: (PyQTWindow.Menu) Object where to add the specified list of Actions
        :param actions: (list) Actions to be added.
        """
        for action in actions:
            if action is None:
                target.addSeparator()
            else:
                target.addAction(action)

    def center(self):
        """
        Places the Main Window of PyVASCO in the top left corner of the sceen.
        """
        frameGm = self.frameGeometry()
        centerPoint = QDesktopWidget().availableGeometry().center()
        #frameGm.moveCenter(centerPoint)
        self.move(frameGm.topLeft())
<script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            >PyVASCO</th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Tue Jul 10 17:28:54 2018
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
